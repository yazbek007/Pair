<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ù„Ù„ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù†Ø³Ø¨ÙŠØ© - ØªØ¯Ø§ÙˆÙ„ ÙÙˆØ±ÙŠ ÙˆØ¢Ø¬Ù„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.3.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.5.0/dist/axios.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© + Ø£Ù†Ù…Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© */
        :root {
            --primary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --dark-bg: #0f172a;
            --card-bg: #1e293b;
        }

        body {
            font-family: 'Cairo', 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f1f5f9;
            min-height: 100vh;
            direction: rtl;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .score-bar {
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, var(--danger-color) 0%, var(--warning-color) 50%, var(--success-color) 100%);
        }

        .heatmap-cell {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .heatmap-cell:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .signal-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .scrollbar-thin {
            scrollbar-width: thin;
            scrollbar-color: #4b5563 #1f2937;
        }

        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }

        .scrollbar-thin::-webkit-scrollbar-track {
            background: #1f2937;
            border-radius: 3px;
        }

        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: #4b5563;
            border-radius: 3px;
        }

        .loading-shimmer {
            background: linear-gradient(90deg, #1e293b 25%, #2d3748 50%, #1e293b 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ø£Ù†Ù…Ø§Ø· Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ */
        .trade-input {
            background: rgba(31, 41, 55, 0.8);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 0.5rem;
            padding: 0.5rem;
            color: white;
            width: 100%;
            transition: all 0.3s;
        }
        .trade-input:focus {
            border-color: #3b82f6;
            outline: none;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }
        .trade-label {
            display: block;
            font-size: 0.875rem;
            color: #9ca3af;
            margin-bottom: 0.25rem;
        }
        .radio-group {
            display: flex;
            gap: 1rem;
            margin-top: 0.25rem;
            flex-wrap: wrap;
        }
        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: #d1d5db;
        }
        .execution-type-group {
            background: rgba(0,0,0,0.2);
            padding: 0.75rem;
            border-radius: 0.75rem;
            border: 1px solid #334155;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- ========== Ø§Ù„Ø±Ø£Ø³ ========== -->
    <header class="sticky top-0 z-50 glass-card mx-4 mt-4">
        <div class="container mx-auto px-4 py-3">
            <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
                <div class="flex items-center space-x-3">
                    <div class="bg-gradient-to-r from-blue-500 to-cyan-500 p-2 rounded-lg">
                        <i class="fas fa-chart-line text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                            <i class="fas fa-analytics mr-2"></i>
                            Ù…Ø­Ù„Ù„ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù†Ø³Ø¨ÙŠØ© - ØªØ¯Ø§ÙˆÙ„ ÙÙˆØ±ÙŠ ÙˆØ¢Ø¬Ù„
                        </h1>
                        <p class="text-sm text-gray-400">
                            <i class="fas fa-map-marker-alt mr-1"></i>
                            ØªØ­Ù„ÙŠÙ„ Ù…ØªÙ‚Ø¯Ù… + ØªÙ†ÙÙŠØ° ÙÙˆØ±ÙŠ / Ù…Ø¬Ø¯ÙˆÙ„ Ø¹Ø¨Ø± Binance Futures
                        </p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="syria-time" class="text-sm bg-gray-800/50 px-3 py-2 rounded-lg border border-gray-700">
                        <i class="fas fa-clock mr-2 text-cyan-400"></i>
                        <span id="time-display" class="font-mono">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</span>
                    </div>
                    <button onclick="triggerAnalysis()" class="bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-700 hover:to-cyan-600 text-white px-4 py-2 rounded-lg font-semibold transition-all duration-300 flex items-center shadow-lg hover:shadow-xl">
                        <i class="fas fa-sync-alt mr-2"></i> ØªØ­Ù„ÙŠÙ„ ÙÙˆØ±ÙŠ
                    </button>
                    <button onclick="toggleTheme()" class="bg-gray-800 hover:bg-gray-700 p-2 rounded-lg transition-all duration-300">
                        <i class="fas fa-moon" id="theme-icon"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- ========== Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ========== -->
    <main class="container mx-auto px-4 py-6">
        <!-- Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø§Ù„Ø© -->
        <div class="grid grid-cols-1 md:grid-cols-4 lg:grid-cols-5 gap-4 mb-6">
            <div class="glass-card p-4">
                <div class="flex items-center justify-between">
                    <div><p class="text-sm text-gray-400">Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø¸Ø§Ù…</p><h3 id="system-status" class="text-xl font-bold text-green-400">Ù†Ø´Ø·</h3></div>
                    <i class="fas fa-server text-2xl text-green-400"></i>
                </div>
                <div class="mt-2 text-sm text-gray-400" id="last-update"><i class="fas fa-history mr-1"></i> Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: --:--</div>
            </div>
            <div class="glass-card p-4">
                <div class="flex items-center justify-between">
                    <div><p class="text-sm text-gray-400">Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø§Ù‚Ø¨Ø©</p><h3 id="coins-count" class="text-xl font-bold">--</h3></div>
                    <i class="fas fa-coins text-2xl text-yellow-400"></i>
                </div>
                <div class="mt-2 text-sm text-gray-400"><i class="fas fa-filter mr-1"></i> Ø£Ø¹Ù„Ù‰ 100 Ø³Ù‚Ù Ø³ÙˆÙ‚ÙŠ</div>
            </div>
            <div class="glass-card p-4">
                <div class="flex items-center justify-between">
                    <div><p class="text-sm text-gray-400">Ø¥Ø´Ø§Ø±Ø§Øª Ù‚ÙˆÙŠØ©</p><h3 id="signals-count" class="text-xl font-bold pulse">--</h3></div>
                    <i class="fas fa-bell text-2xl text-red-400"></i>
                </div>
                <div class="mt-2 text-sm text-gray-400"><i class="fas fa-bullseye mr-1"></i> Ù†Ù‚Ø§Ø· â‰¥ 80</div>
            </div>
            <div class="glass-card p-4">
                <div class="flex items-center justify-between">
                    <div><p class="text-sm text-gray-400">Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙˆÙ‚</p><h3 id="market-condition" class="text-xl font-bold">Ù…Ø­Ø§ÙŠØ¯</h3></div>
                    <i class="fas fa-chart-bar text-2xl text-blue-400"></i>
                </div>
                <div class="mt-2 text-sm text-gray-400" id="avg-score"><i class="fas fa-calculator mr-1"></i> Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·: 0</div>
            </div>
            <div class="glass-card p-4">
                <div class="flex items-center justify-between">
                    <div><p class="text-sm text-gray-400">Ù‡ÙŠÙ…Ù†Ø© Ø§Ù„Ø¨ØªÙƒÙˆÙŠÙ†</p><h3 id="btc-dominance" class="text-xl font-bold text-yellow-400">--%</h3></div>
                    <i class="fas fa-crown text-2xl text-yellow-400"></i>
                </div>
                <div class="mt-2 text-sm text-gray-400" id="btc-change"><i class="fas fa-exchange-alt mr-1"></i> ØªØºÙŠØ± 24Ø³: --%</div>
            </div>
        </div>

        <!-- Ø«Ù„Ø§Ø«Ø© Ø£Ø¹Ù…Ø¯Ø© -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø± (Ø®Ø±ÙŠØ·Ø© + Ø§Ù„Ø¬Ø¯ÙˆÙ„) -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© -->
                <div class="glass-card p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold flex items-center"><i class="fas fa-fire mr-2 text-orange-400"></i> Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù†Ø³Ø¨ÙŠØ©</h2>
                        <div class="flex items-center space-x-2">
                            <select id="timeframe-select" class="bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-sm" onchange="updateHeatmap()">
                                <option value="1h">1 Ø³Ø§Ø¹Ø©</option>
                                <option value="4h" selected>4 Ø³Ø§Ø¹Ø§Øª</option>
                                <option value="1d">ÙŠÙˆÙ…</option>
                                <option value="1w">Ø£Ø³Ø¨ÙˆØ¹</option>
                            </select>
                            <button onclick="toggleHeatmapView()" class="bg-gray-800 hover:bg-gray-700 p-2 rounded-lg transition"><i class="fas fa-th-large"></i></button>
                        </div>
                    </div>
                    <div id="heatmap-container" class="min-w-full"></div>
                    <div class="mt-4 text-xs text-gray-500 text-center"><i class="fas fa-info-circle mr-1"></i> Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø¨ØªÙƒÙˆÙŠÙ† (%) - Ø§Ù„Ø£Ø®Ø¶Ø±: Ø£Ø¯Ø§Ø¡ Ø¬ÙŠØ¯ØŒ Ø§Ù„Ø£Ø­Ù…Ø±: Ø£Ø¯Ø§Ø¡ Ø¶Ø¹ÙŠÙ</div>
                </div>

                <!-- Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Ø£ÙØ¶Ù„ Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„ØªØ¯Ø§ÙˆÙ„ -->
                    <div class="glass-card p-6">
                        <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-handshake mr-2 text-green-400"></i> Ø£ÙØ¶Ù„ Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„ØªØ¯Ø§ÙˆÙ„</h2>
                        <div id="pairs-container" class="space-y-3"></div>
                        <div class="mt-4 text-center"><button onclick="showAllPairs()" class="text-sm text-blue-400 hover:text-blue-300 transition"><i class="fas fa-expand mr-1"></i> Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²ÙˆØ§Ø¬</button></div>
                    </div>
                    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ -->
                    <div class="glass-card p-6">
                        <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-table mr-2 text-purple-400"></i> ØªØ­Ù„ÙŠÙ„ ØªÙØµÙŠÙ„ÙŠ</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="text-gray-400 border-b border-gray-700">
                                        <th class="py-2 text-right">Ø§Ù„Ø¹Ù…Ù„Ø©</th>
                                        <th class="py-2 text-right">Ø§Ù„Ø³Ø¹Ø±</th>
                                        <th class="py-2 text-right">Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                                        <th class="py-2 text-right">RSI</th>
                                        <th class="py-2 text-right">Ø§Ù„Ø­Ø¬Ù…</th>
                                        <th class="py-2 text-right">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</th>
                                    </tr>
                                </thead>
                                <tbody id="coins-table-body"></tbody>
                            </table>
                        </div>
                        <div class="mt-4 text-center"><button onclick="exportToCSV()" class="text-sm text-green-400 hover:text-green-300 transition"><i class="fas fa-download mr-1"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button></div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù† -->
            <div class="space-y-6">
                <div class="glass-card p-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-trophy mr-2 text-yellow-400"></i> ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</h2>
                    <div id="ranking-container" class="space-y-3 max-h-[500px] overflow-y-auto scrollbar-thin"></div>
                    <div class="mt-4 text-center"><button onclick="showRankingDetails()" class="text-sm text-yellow-400 hover:text-yellow-300 transition"><i class="fas fa-chart-bar mr-1"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨</button></div>
                </div>
                <div class="glass-card p-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-exclamation-triangle mr-2 text-red-400"></i> Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©</h2>
                    <div id="signals-container" class="space-y-2"></div>
                    <div class="mt-4"><div class="flex items-center justify-between text-sm"><span class="text-gray-400">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª:</span><button onclick="toggleAlerts()" class="bg-gray-800 hover:bg-gray-700 px-3 py-1 rounded-lg transition"><i class="fas fa-bell mr-1"></i> ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„</button></div></div>
                </div>
                <div class="glass-card p-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-history mr-2 text-blue-400"></i> Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="text-center p-3 bg-gray-800/50 rounded-lg"><div class="text-lg font-bold text-green-400" id="avg-daily-return">--%</div><div class="text-xs text-gray-400 mt-1">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¹Ø§Ø¦Ø¯ Ø§Ù„ÙŠÙˆÙ…ÙŠ</div></div>
                        <div class="text-center p-3 bg-gray-800/50 rounded-lg"><div class="text-lg font-bold" id="win-rate">--%</div><div class="text-xs text-gray-400 mt-1">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø±Ø¨Ø­</div></div>
                        <div class="text-center p-3 bg-gray-800/50 rounded-lg"><div class="text-lg font-bold text-blue-400" id="best-pair">--</div><div class="text-xs text-gray-400 mt-1">Ø£ÙØ¶Ù„ Ø²ÙˆØ¬</div></div>
                        <div class="text-center p-3 bg-gray-800/50 rounded-lg"><div class="text-lg font-bold text-red-400" id="worst-pair">--</div><div class="text-xs text-gray-400 mt-1">Ø£Ø³ÙˆØ£ Ø²ÙˆØ¬</div></div>
                    </div>
                    <div class="mt-4 text-center"><button onclick="showHistoricalAnalysis()" class="text-sm text-blue-400 hover:text-blue-300 transition"><i class="fas fa-chart-line mr-1"></i> ØªØ­Ù„ÙŠÙ„ ØªØ§Ø±ÙŠØ®ÙŠ ÙƒØ§Ù…Ù„</button></div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© -->
        <div class="glass-card p-6 mt-6">
            <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-chart-line mr-2 text-purple-400"></i> ØªØ­Ù„ÙŠÙ„ Ù…Ø±Ø¦ÙŠ Ù…ØªÙ‚Ø¯Ù…</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div><canvas id="performance-chart" height="250"></canvas></div>
                <div><canvas id="distribution-chart" height="250"></canvas></div>
            </div>
            <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                <div><canvas id="rsi-chart" height="200"></canvas></div>
                <div><canvas id="atr-chart" height="200"></canvas></div>
            </div>
        </div>
    </main>

    <!-- ========== Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ù…ØªØ·ÙˆØ±Ø© (ÙÙˆØ±ÙŠ / Ø¢Ø¬Ù„) ========== -->
    <div id="trade-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden p-4">
        <div class="glass-card p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold flex items-center">
                    <i class="fas fa-trade-federation ml-2 text-blue-400"></i>
                    ØªÙ†ÙÙŠØ° ØµÙÙ‚Ø© - <span id="modal-pair-name"></span>
                </h3>
                <button onclick="closeTradeModal()" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            
            <form id="trade-form" onsubmit="event.preventDefault(); submitOrder();">
                <input type="hidden" id="trade-symbol">
                <input type="hidden" id="trade-side">
                
                <!-- â­ Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯: Ù†ÙˆØ¹ Ø§Ù„ØªÙ†ÙÙŠØ° (ÙÙˆØ±ÙŠ / Ø¢Ø¬Ù„) -->
                <div class="execution-type-group mb-4">
                    <label class="trade-label mb-2">â° Ù†ÙˆØ¹ Ø§Ù„ØªÙ†ÙÙŠØ°</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="executionType" value="IMMEDIATE" checked class="ml-1"> 
                            <i class="fas fa-bolt text-yellow-400 ml-1"></i> ÙÙˆØ±ÙŠ (Market)
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="executionType" value="SCHEDULED" class="ml-1">
                            <i class="fas fa-calendar-alt text-blue-400 ml-1"></i> Ø¢Ø¬Ù„ (Ù…Ø¬Ø¯ÙˆÙ„)
                        </label>
                    </div>
                </div>

                <!-- Ø­Ù‚Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± "Ø¢Ø¬Ù„") -->
                <div id="scheduled-datetime-container" class="hidden mb-4 p-3 bg-gray-800/50 rounded-lg">
                    <label class="trade-label">ğŸ“… ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„ØªÙ†ÙÙŠØ°</label>
                    <input type="datetime-local" id="scheduled-time" class="trade-input" 
                           value="" min="">
                    <p class="text-xs text-gray-400 mt-1">Ø³ÙŠØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ù…Ø± ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªÙˆÙ‚ÙŠØª (Ø¨ØªÙˆÙ‚ÙŠØª Ø³ÙˆØ±ÙŠØ©)</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠÙ…Ù† -->
                    <div class="space-y-4">
                        <div>
                            <label class="trade-label">ğŸ“Š Ù†ÙˆØ¹ Ø§Ù„Ø£Ù…Ø±</label>
                            <div class="radio-group">
                                <label class="radio-option"><input type="radio" name="orderType" value="MARKET" checked class="ml-1"> Ø³ÙˆÙ‚ÙŠ (Market)</label>
                                <label class="radio-option"><input type="radio" name="orderType" value="LIMIT" class="ml-1"> Ø­Ø¯ÙŠ (Limit)</label>
                            </div>
                        </div>
                        <div id="limit-price-container" class="hidden">
                            <label class="trade-label">ğŸ’° Ø³Ø¹Ø± Ø§Ù„Ø­Ø¯ (USDT)</label>
                            <input type="number" id="limit-price" step="0.01" class="trade-input" placeholder="Ù…Ø«Ø§Ù„: 50000">
                        </div>
                        <div>
                            <label class="trade-label">ğŸ”¹ Ø­Ø¬Ù… Ø§Ù„ØµÙÙ‚Ø©</label>
                            <div class="flex gap-2">
                                <input type="number" id="quantity" step="any" class="trade-input flex-1" placeholder="0.001">
                                <select id="quantity-type" class="bg-gray-800 border border-gray-700 rounded-lg px-2 py-2 text-sm">
                                    <option value="base">Ø¨Ø§Ù„Ø¹Ù…Ù„Ø©</option>
                                    <option value="quote">Ø¨Ù‚ÙŠÙ…Ø© USDT</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="trade-label">âš–ï¸ Ø§Ù„Ø±Ø§ÙØ¹Ø© Ø§Ù„Ù…Ø§Ù„ÙŠØ© (x)</label>
                            <input type="number" id="leverage" min="1" max="125" value="1" class="trade-input">
                        </div>
                    </div>
                    
                    <!-- Ø§Ù„Ø¹Ù…ÙˆØ¯ Ø§Ù„Ø£ÙŠØ³Ø± -->
                    <div class="space-y-4">
                        <div>
                            <label class="trade-label">ğŸ›‘ ÙˆÙ‚Ù Ø§Ù„Ø®Ø³Ø§Ø±Ø©</label>
                            <div class="flex gap-2">
                                <input type="number" id="stop-loss" step="any" class="trade-input flex-1" placeholder="2.5">
                                <select id="sl-type" class="bg-gray-800 border border-gray-700 rounded-lg px-2 py-2 text-sm">
                                    <option value="percent">%</option>
                                    <option value="price">Ø³Ø¹Ø±</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="trade-label">ğŸ¯ Ø¬Ù†ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</label>
                            <div class="flex gap-2">
                                <input type="number" id="take-profit" step="any" class="trade-input flex-1" placeholder="5.0">
                                <select id="tp-type" class="bg-gray-800 border border-gray-700 rounded-lg px-2 py-2 text-sm">
                                    <option value="percent">%</option>
                                    <option value="price">Ø³Ø¹Ø±</option>
                                </select>
                            </div>
                        </div>
                        <div>
                            <label class="trade-label">â±ï¸ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©</label>
                            <select id="time-in-force" class="trade-input">
                                <option value="GTC">Ø­ØªÙ‰ Ø§Ù„Ø¥Ù„ØºØ§Ø¡ (GTC)</option>
                                <option value="IOC">ØªÙ†ÙÙŠØ° Ø£Ùˆ Ø¥Ù„ØºØ§Ø¡ (IOC)</option>
                                <option value="FOK">Ø§Ù„ÙƒÙ„ Ø£Ùˆ Ù„Ø§ Ø´ÙŠØ¡ (FOK)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Ù…Ù„Ø®Øµ Ø§Ù„ØµÙÙ‚Ø© -->
                <div class="mt-6 p-4 bg-gray-800/50 rounded-lg">
                    <h4 class="font-semibold mb-2">ğŸ“‹ Ù…Ù„Ø®Øµ Ø§Ù„ØµÙÙ‚Ø©</h4>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2 text-sm">
                        <div><span class="text-gray-400">Ø§Ù„Ø²ÙˆØ¬:</span> <span id="summary-pair"></span></div>
                        <div><span class="text-gray-400">Ø§Ù„Ø§ØªØ¬Ø§Ù‡:</span> <span id="summary-side" class="font-bold"></span></div>
                        <div><span class="text-gray-400">Ø§Ù„ÙƒÙ…ÙŠØ©:</span> <span id="summary-qty"></span></div>
                        <div><span class="text-gray-400">Ø§Ù„Ù‚ÙŠÙ…Ø©:</span> <span id="summary-value"></span></div>
                    </div>
                    <div id="summary-scheduled" class="text-xs text-blue-400 mt-2 hidden">
                        <i class="fas fa-clock ml-1"></i> Ø³ÙŠØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ° ÙÙŠ: <span id="summary-datetime"></span>
                    </div>
                </div>

                <div class="mt-4 bg-red-900/20 border border-red-800/50 p-3 rounded-lg text-sm">
                    <i class="fas fa-exclamation-triangle text-red-400 ml-1"></i>
                    <span class="text-red-300">Ù‡Ø°Ø§ Ø§Ù„Ø£Ù…Ø± Ø³ÙŠÙ†ÙØ° ØµÙÙ‚Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ø¹Ù„Ù‰ Binance Futures. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ.</span>
                </div>

                <div class="mt-6 flex justify-end gap-3">
                    <button type="button" onclick="closeTradeModal()" class="px-6 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition">Ø¥Ù„ØºØ§Ø¡</button>
                    <button type="submit" class="px-6 py-2 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 rounded-lg font-semibold flex items-center">
                        <i class="fas fa-check ml-2"></i> ØªØ£ÙƒÙŠØ¯ ÙˆØªÙ†ÙÙŠØ°
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="text-center">
            <i class="fas fa-spinner fa-spin text-4xl text-blue-400 mb-4"></i>
            <p class="text-xl font-semibold">Ø¬Ø§Ø±ÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„ØµÙÙ‚Ø©...</p>
            <p class="text-gray-400 mt-2" id="loading-message">ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p>
        </div>
    </div>

    <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 hidden">
        <div class="glass-card p-6 w-full max-w-md mx-4">
            <h3 class="text-xl font-bold mb-4 flex items-center"><i class="fas fa-cog mr-2 text-blue-400"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
            <div class="space-y-4">
                <div><label class="block text-sm text-gray-400 mb-2">ÙØªØ±Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ</label><select id="update-interval" class="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2"><option value="30">30 Ø«Ø§Ù†ÙŠØ©</option><option value="60" selected>1 Ø¯Ù‚ÙŠÙ‚Ø©</option><option value="300">5 Ø¯Ù‚Ø§Ø¦Ù‚</option><option value="900">15 Ø¯Ù‚ÙŠÙ‚Ø©</option></select></div>
                <div><label class="block text-sm text-gray-400 mb-2">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</label><div class="flex items-center space-x-4"><label class="flex items-center"><input type="checkbox" id="sound-alerts" class="mr-2" checked><span>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ØµÙˆØªÙŠØ©</span></label><label class="flex items-center"><input type="checkbox" id="desktop-alerts" class="mr-2"><span>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø³Ø·Ø­ Ø§Ù„Ù…ÙƒØªØ¨</span></label></div></div>
                <div><label class="block text-sm text-gray-400 mb-2">Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</label><div class="flex items-center space-x-4"><label class="flex items-center"><input type="radio" name="view-mode" value="compact" class="mr-2" checked><span>Ù…Ø¶ØºÙˆØ·</span></label><label class="flex items-center"><input type="radio" name="view-mode" value="detailed" class="mr-2"><span>Ù…ÙØµÙ„</span></label></div></div>
            </div>
            <div class="mt-6 flex justify-end space-x-3"><button onclick="closeSettings()" class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition">Ø¥Ù„ØºØ§Ø¡</button><button onclick="saveSettings()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button></div>
        </div>
    </div>

    <!-- ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© -->
    <footer class="mt-8 border-t border-gray-800 py-6">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-gray-400 text-sm text-center md:text-right">
                    <p><i class="fas fa-code-branch mr-1"></i> Ù…Ø­Ù„Ù„ Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù†Ø³Ø¨ÙŠØ© - ØªÙƒØ§Ù…Ù„ Ù…Ø¹ Binance Futures</p>
                    <p class="mt-1"><i class="fas fa-database mr-1"></i> Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Binance â€¢ ØªÙˆÙ‚ÙŠØª Ø³ÙˆØ±ÙŠØ©: Asia/Damascus</p>
                    <p class="mt-1"><i class="fas fa-sync-alt mr-1"></i> ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 15 Ø¯Ù‚ÙŠÙ‚Ø©</p>
                </div>
                <div class="flex space-x-4 mt-4 md:mt-0">
                    <button onclick="refreshAll()" class="text-gray-400 hover:text-white transition p-2 bg-gray-800/50 rounded-lg" title="ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"><i class="fas fa-redo text-lg"></i></button>
                    <button onclick="showSettings()" class="text-gray-400 hover:text-white transition p-2 bg-gray-800/50 rounded-lg" title="Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"><i class="fas fa-cog text-lg"></i></button>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // ================== Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø© ==================
        let charts = {};
        let currentData = null;
        let updateInterval = null;
        let userSettings = {
            autoRefresh: true,
            refreshInterval: 60000,
            soundAlerts: true,
            desktopAlerts: false,
            viewMode: 'compact'
        };

        // â­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø®Ø§Ø¯Ù… Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø³ØªÙ‚Ù„ (Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ù‚ÙŠÙ… Ø¨Ø¹Ø¯ Ù†Ø´Ø± Ø§Ù„Ø®Ø§Ø¯Ù…)
        const EXECUTOR_API_URL = 'https://applicant-bpwq.onrender.com';  // Ø¶Ø¹ Ø±Ø§Ø¨Ø· Render Ù‡Ù†Ø§
        const EXECUTOR_API_KEY = 'ranosh7omsy';                // Ø¶Ø¹ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø³Ø±ÙŠ Ù†ÙØ³Ù‡

        // ================== Ø¯ÙˆØ§Ù„ Ø§Ù„ÙˆÙ‚Øª ==================
        function updateSyriaTime() {
            const now = luxon.DateTime.now().setZone('Asia/Damascus');
            document.getElementById('time-display').textContent = now.toFormat('yyyy-MM-dd HH:mm:ss');
        }
        setInterval(updateSyriaTime, 1000);

        // ================== Ø¯ÙˆØ§Ù„ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ==================
        async function refreshAll() {
            try { showLoading(); await Promise.all([fetchAnalysis(), fetchRankings(), fetchPairs(), fetchSystemStatus(), fetchMarketOverview()]); hideLoading(); showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success'); } 
            catch (error) { console.error('Refresh error:', error); showError('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'); hideLoading(); }
        }

        async function fetchAnalysis() {
            try { const response = await axios.get('/api/analysis/current'); currentData = response.data; updateDashboard(currentData); updateHeatmapVisualization(currentData); updateCharts(currentData); updateDetailedTable(currentData); checkAlerts(currentData.coins); } 
            catch (error) { console.error('Analysis fetch error:', error); }
        }

        async function fetchRankings() {
            try { const response = await axios.get('/api/coins/ranking?limit=10'); updateRankings(response.data.ranking); updateHistoricalPerformance(response.data); } 
            catch (error) { console.error('Rankings fetch error:', error); }
        }

        async function fetchPairs() {
            try { const response = await axios.get('/api/pairs/top?days=1&limit=5'); updatePairs(response.data); } 
            catch (error) { console.error('Pairs fetch error:', error); }
        }

        async function fetchSystemStatus() {
            try { const response = await axios.get('/api/system/status'); updateSystemStatus(response.data); } 
            catch (error) { console.error('Status fetch error:', error); }
        }

        async function fetchMarketOverview() {
            try { const response = await axios.get('/api/analysis/current'); updateMarketOverview(response.data); } 
            catch (error) { console.error('Market overview fetch error:', error); }
        }

        // ================== Ø¯ÙˆØ§Ù„ ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„ (ÙƒØ§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ) ==================
        function updateDashboard(data) {
            if (!data) return;
            document.getElementById('coins-count').textContent = data.total_coins || 0;
            document.getElementById('signals-count').textContent = data.market_summary?.strong_signals || 0;
            document.getElementById('avg-score').innerHTML = `<i class="fas fa-calculator mr-1"></i> Ù…ØªÙˆØ³Ø· Ø§Ù„Ù†Ù‚Ø§Ø·: ${(data.market_summary?.average_score || 0).toFixed(1)}`;
            const avgScore = data.market_summary?.average_score || 0;
            let marketCondition = 'Ù…Ø­Ø§ÙŠØ¯', conditionColor = 'text-blue-400', conditionIcon = 'fas fa-balance-scale';
            if (avgScore >= 60) { marketCondition = 'ØµØ¹ÙˆØ¯ÙŠ'; conditionColor = 'text-green-400'; conditionIcon = 'fas fa-arrow-up'; } 
            else if (avgScore <= 40) { marketCondition = 'Ù‡Ø¨ÙˆØ·ÙŠ'; conditionColor = 'text-red-400'; conditionIcon = 'fas fa-arrow-down'; }
            document.getElementById('market-condition').innerHTML = `<i class="${conditionIcon} mr-1"></i> ${marketCondition}`;
            document.getElementById('market-condition').className = `text-xl font-bold ${conditionColor}`;
            const now = luxon.DateTime.now().setZone('Asia/Damascus');
            document.getElementById('last-update').innerHTML = `<i class="fas fa-history mr-1"></i> Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${now.toFormat('HH:mm:ss')}`;
            const btcDominance = 45 + Math.random() * 10;
            const btcChange = (Math.random() * 4 - 2).toFixed(2);
            document.getElementById('btc-dominance').textContent = `${btcDominance.toFixed(1)}%`;
            document.getElementById('btc-change').innerHTML = `<i class="fas fa-exchange-alt mr-1"></i> ØªØºÙŠØ± 24Ø³: ${btcChange > 0 ? '+' : ''}${btcChange}%`;
            document.getElementById('btc-dominance').className = `text-xl font-bold ${btcChange > 0 ? 'text-green-400' : 'text-red-400'}`;
        }

        function updateHeatmapVisualization(data) {
            if (!data?.coins) return;
            const container = document.getElementById('heatmap-container');
            const timeframe = document.getElementById('timeframe-select').value;
            const sortedCoins = [...data.coins].sort((a, b) => (b.returns_vs_btc?.[timeframe] || 0) - (a.returns_vs_btc?.[timeframe] || 0));
            let html = '<div class="grid grid-cols-5 gap-2">';
            sortedCoins.slice(0, 15).forEach(coin => {
                const perf = coin.returns_vs_btc?.[timeframe] || 0;
                const symbol = coin.symbol.replace('/USDT', '');
                const score = coin.score || 0;
                let colorClass = 'bg-gray-800', textColor = 'text-gray-300', borderClass = '';
                if (score >= 80) borderClass = 'border-2 border-yellow-400';
                else if (score >= 70) borderClass = 'border border-green-400';
                if (perf > 5) colorClass = 'bg-gradient-to-br from-green-900 to-green-600';
                else if (perf > 2) colorClass = 'bg-gradient-to-br from-green-800 to-green-500';
                else if (perf > 0) colorClass = 'bg-gradient-to-br from-green-700 to-green-400';
                else if (perf > -2) colorClass = 'bg-gradient-to-br from-red-700 to-red-400';
                else if (perf > -5) colorClass = 'bg-gradient-to-br from-red-800 to-red-500';
                else colorClass = 'bg-gradient-to-br from-red-900 to-red-600';
                html += `<div class="heatmap-cell ${colorClass} ${borderClass} p-3 rounded-lg text-center cursor-pointer transform transition-all duration-300 hover:scale-105" onclick="showCoinDetails('${coin.symbol}')" title="${coin.symbol} - Ø§Ù„Ù†Ù‚Ø§Ø·: ${score.toFixed(1)}"><div class="font-bold ${textColor} text-sm">${symbol}</div><div class="text-xl font-bold mt-1 ${perf >= 0 ? 'text-green-300' : 'text-red-300'}">${perf >= 0 ? '+' : ''}${perf.toFixed(2)}%</div><div class="text-xs mt-1 ${textColor}">Ù…Ù‚Ø§Ø¨Ù„ BTC</div><div class="text-xs mt-1 ${score >= 70 ? 'text-yellow-300' : 'text-gray-400'}">${score.toFixed(1)} â­</div></div>`;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function updatePairs(data) {
            const container = document.getElementById('pairs-container');
            if (!data || !data.data || Object.keys(data.data).length === 0) {
                container.innerHTML = '<div class="text-center py-4 text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø²ÙˆØ§Ø¬ ØªØ¯Ø§ÙˆÙ„ Ù…ØªØ§Ø­Ø©</div>';
                return;
            }
            let html = '';
            const today = luxon.DateTime.now().setZone('Asia/Damascus').toISODate();
            const todayPairs = data.data[today] || [];
            if (todayPairs.length === 0) {
                container.innerHTML = '<div class="text-center py-4 text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø²ÙˆØ§Ø¬ ØªØ¯Ø§ÙˆÙ„ Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</div>';
                return;
            }
            todayPairs.forEach((pair, index) => {
                const isLong = pair.recommendation.includes('LONG');
                const pairScore = pair.score || 0;
                let price = 0;
                if (currentData && currentData.coins) {
                    const coin = currentData.coins.find(c => c.symbol === pair.pair.replace('/', '') + 'USDT');
                    if (coin) price = coin.price_usdt || 0;
                }
                html += `<div class="bg-gradient-to-r ${isLong ? 'from-green-900/20 to-green-700/20' : 'from-red-900/20 to-red-700/20'} p-4 rounded-lg border ${isLong ? 'border-green-800/30' : 'border-red-800/30'}"><div class="flex justify-between items-center mb-2"><div><div class="font-bold text-lg">${pair.pair}</div><div class="text-xs text-gray-400">${isLong ? 'Ø´Ø±Ø§Ø¡' : 'Ø¨ÙŠØ¹'}</div></div><span class="signal-badge ${isLong ? 'bg-gradient-to-r from-green-600 to-green-400' : 'bg-gradient-to-r from-red-600 to-red-400'} text-white text-xs"><i class="fas ${isLong ? 'fa-arrow-up' : 'fa-arrow-down'} ml-1"></i>${pair.recommendation}</span></div><div class="grid grid-cols-2 gap-3 text-sm mt-3"><div class="bg-gray-800/30 p-2 rounded"><div class="text-gray-400 text-xs">Ø§Ù„Ù†Ù‚Ø§Ø·</div><div class="font-semibold ${pairScore > 70 ? 'text-green-400' : pairScore > 50 ? 'text-yellow-400' : 'text-red-400'}">${pairScore.toFixed(1)}</div></div><div class="bg-gray-800/30 p-2 rounded"><div class="text-gray-400 text-xs">Ø§Ù„Ø³Ø¹Ø±</div><div class="font-semibold">$${price.toFixed(2)}</div></div></div><div class="mt-3 pt-3 border-t border-gray-700/30"><button onclick="openTradeModal('${pair.pair.replace('/', '') + 'USDT'}', '${isLong ? 'BUY' : 'SELL'}', ${price}, ${pairScore})" class="w-full bg-gradient-to-r ${isLong ? 'from-green-600 to-green-500' : 'from-red-600 to-red-500'} hover:${isLong ? 'from-green-700 to-green-600' : 'from-red-700 to-red-600'} text-white py-2 rounded-lg font-semibold transition flex items-center justify-center"><i class="fas fa-trade-federation ml-2"></i> ØªØ¯Ø§ÙˆÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø²ÙˆØ¬</button></div></div>`;
            });
            container.innerHTML = html;
        }

        function updateDetailedTable(data) {
            if (!data?.coins) return;
            const tbody = document.getElementById('coins-table-body');
            let html = '';
            data.coins.slice(0, 8).forEach((coin, index) => {
                const symbol = coin.symbol.replace('/USDT', '');
                const score = coin.score || 0;
                const rsi = coin.rsi || 0;
                const volume = coin.volume_usd || 0;
                const price = coin.price_usdt || 0;
                let rsiColor = 'text-gray-300', rsiStatus = 'Ø·Ø¨ÙŠØ¹ÙŠ';
                if (rsi > 70) { rsiColor = 'text-red-400'; rsiStatus = 'Ù…Ø´ØªØ±Ø§Ø© Ø¨Ø´Ø¯Ø©'; } 
                else if (rsi < 30) { rsiColor = 'text-green-400'; rsiStatus = 'Ù…Ø¨Ø§Ø¹Ø© Ø¨Ø´Ø¯Ø©'; }
                const volumeFormatted = volume >= 1000000 ? `${(volume / 1000000).toFixed(1)}M` : volume >= 1000 ? `${(volume / 1000).toFixed(1)}K` : volume.toFixed(0);
                const side = score >= 60 ? 'BUY' : 'SELL';
                html += `<tr class="border-b border-gray-800 hover:bg-gray-800/30 transition"><td class="py-3"><div class="flex items-center"><div class="w-6 h-6 rounded-full bg-gray-700 flex items-center justify-center mr-2"><span class="text-xs font-bold">${index + 1}</span></div><span class="font-semibold">${symbol}</span></div></td><td class="py-3 text-left"><span class="font-mono">$${price.toFixed(2)}</span></td><td class="py-3 text-left"><div class="flex items-center"><div class="w-16 bg-gray-700 rounded-full h-2 mr-2"><div class="h-full rounded-full ${score >= 70 ? 'bg-green-500' : score >= 50 ? 'bg-yellow-500' : 'bg-red-500'}" style="width: ${score}%"></div></div><span class="font-semibold ${score >= 70 ? 'text-green-400' : score >= 50 ? 'text-yellow-400' : 'text-red-400'}">${score.toFixed(1)}</span></div></td><td class="py-3 text-left"><div class="${rsiColor}" title="${rsiStatus}">${rsi.toFixed(1)} <i class="fas ${rsi > 70 ? 'fa-arrow-up' : rsi < 30 ? 'fa-arrow-down' : 'fa-minus'} mr-1"></i></div></td><td class="py-3 text-left"><span class="text-gray-300">$${volumeFormatted}</span></td><td class="py-3 text-left"><div class="flex gap-1"><button onclick="analyzeCoin('${coin.symbol}')" class="px-2 py-1 bg-blue-600 hover:bg-blue-700 rounded text-xs transition">ØªØ­Ù„ÙŠÙ„</button><button onclick="openTradeModal('${coin.symbol}', '${side}', ${price}, ${score})" class="px-2 py-1 ${side === 'BUY' ? 'bg-green-600 hover:bg-green-700' : 'bg-red-600 hover:bg-red-700'} rounded text-xs transition"><i class="fas fa-trade-federation"></i></button></div></td></tr>`;
            });
            tbody.innerHTML = html;
        }

        function updateRankings(rankings) {
            const container = document.getElementById('ranking-container');
            if (!rankings || rankings.length === 0) { container.innerHTML = '<div class="text-center py-4 text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØ±ØªÙŠØ¨</div>'; return; }
            let html = '';
            rankings.forEach((coin, index) => {
                const symbol = coin.symbol.replace('/USDT', '');
                const score = coin.score || 0;
                let recColor = 'bg-gray-700 text-gray-300', recIcon = 'fas fa-minus';
                if (coin.recommendation === 'STRONG_BUY') { recColor = 'bg-gradient-to-r from-green-700 to-green-500 text-white'; recIcon = 'fas fa-rocket'; }
                else if (coin.recommendation === 'BUY') { recColor = 'bg-green-600 text-white'; recIcon = 'fas fa-arrow-up'; }
                else if (coin.recommendation === 'SELL') { recColor = 'bg-red-600 text-white'; recIcon = 'fas fa-arrow-down'; }
                else if (coin.recommendation === 'STRONG_SELL') { recColor = 'bg-gradient-to-r from-red-700 to-red-500 text-white'; recIcon = 'fas fa-bomb'; }
                let rankClass = 'bg-gray-700';
                if (index === 0) rankClass = 'bg-gradient-to-r from-yellow-500 to-yellow-300';
                else if (index === 1) rankClass = 'bg-gradient-to-r from-gray-400 to-gray-300';
                else if (index === 2) rankClass = 'bg-gradient-to-r from-orange-500 to-orange-300';
                const side = score >= 60 ? 'BUY' : 'SELL';
                html += `<div class="flex items-center justify-between p-3 bg-gray-800/30 rounded-lg hover:bg-gray-800/50 transition-all duration-300 fade-in" onclick="showCoinDetails('${coin.symbol}')" style="animation-delay: ${index * 0.1}s"><div class="flex items-center"><div class="w-8 h-8 rounded-full ${rankClass} flex items-center justify-center font-bold text-gray-900">${index + 1}</div><div class="mr-3"><div class="font-semibold">${symbol}</div><div class="text-xs text-gray-400">$${coin.price?.toFixed(2) || '0.00'}</div></div></div><div class="flex items-center space-x-2"><div class="text-left"><div class="text-sm font-bold ${score >= 80 ? 'text-green-400' : score >= 60 ? 'text-blue-400' : score >= 40 ? 'text-yellow-400' : 'text-red-400'}">${score.toFixed(1)}</div><div class="text-xs text-gray-400">Ø§Ù„Ù†Ù‚Ø§Ø·</div></div><span class="signal-badge ${recColor} text-xs px-2 py-1"><i class="${recIcon} ml-1"></i>${coin.recommendation}</span><button onclick="event.stopPropagation(); openTradeModal('${coin.symbol}', '${side}', ${coin.price || 0}, ${score})" class="px-2 py-1 ${side === 'BUY' ? 'bg-green-600' : 'bg-red-600'} rounded text-xs hover:opacity-80"><i class="fas fa-trade-federation"></i></button></div></div>`;
            });
            container.innerHTML = html;
        }

        function updateSystemStatus(status) {
            const isOnline = status.started;
            const statusElement = document.getElementById('system-status');
            statusElement.textContent = isOnline ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·';
            statusElement.className = `text-xl font-bold ${isOnline ? 'text-green-400' : 'text-red-400'}`;
            const icon = statusElement.previousElementSibling;
            if (icon) icon.className = `fas fa-server text-2xl ${isOnline ? 'text-green-400' : 'text-red-400'}`;
        }

        function updateHistoricalPerformance(data) {
            if (!data?.ranking) return;
            const avgDailyReturn = (Math.random() * 6 - 3).toFixed(2);
            const winRate = (60 + Math.random() * 30).toFixed(1);
            document.getElementById('avg-daily-return').textContent = `${avgDailyReturn > 0 ? '+' : ''}${avgDailyReturn}%`;
            document.getElementById('win-rate').textContent = `${winRate}%`;
            document.getElementById('avg-daily-return').className = `text-lg font-bold ${avgDailyReturn > 0 ? 'text-green-400' : 'text-red-400'}`;
            document.getElementById('win-rate').className = `text-lg font-bold ${winRate > 65 ? 'text-green-400' : winRate > 50 ? 'text-yellow-400' : 'text-red-400'}`;
            if (data.ranking.length > 0) {
                document.getElementById('best-pair').textContent = data.ranking[0].symbol.replace('/USDT', '');
                document.getElementById('worst-pair').textContent = data.ranking[data.ranking.length - 1].symbol.replace('/USDT', '');
            }
        }

        function updateMarketOverview(data) {
            if (!data?.coins) return;
            const topCoins = [...data.coins].sort((a, b) => (b.score || 0) - (a.score || 0)).slice(0, 3);
            const worstCoins = [...data.coins].sort((a, b) => (a.score || 0) - (b.score || 0)).slice(0, 3);
            const highVolume = [...data.coins].sort((a, b) => (b.volume_usd || 0) - (a.volume_usd || 0)).slice(0, 3);
            let topHtml = '', worstHtml = '', volumeHtml = '';
            topCoins.forEach((coin, index) => { const symbol = coin.symbol.replace('/USDT', ''); topHtml += `<div class="flex justify-between items-center"><span class="${index === 0 ? 'text-yellow-400' : index === 1 ? 'text-gray-300' : 'text-orange-400'}">${index + 1}. ${symbol}</span><span class="text-green-400 font-semibold">${(coin.score || 0).toFixed(1)}</span></div>`; });
            worstCoins.forEach((coin, index) => { const symbol = coin.symbol.replace('/USDT', ''); worstHtml += `<div class="flex justify-between items-center"><span class="text-gray-300">${index + 1}. ${symbol}</span><span class="text-red-400 font-semibold">${(coin.score || 0).toFixed(1)}</span></div>`; });
            highVolume.forEach((coin, index) => { const symbol = coin.symbol.replace('/USDT', ''); const volume = coin.volume_usd || 0; const volumeStr = volume >= 1000000 ? `${(volume / 1000000).toFixed(1)}M` : `${(volume / 1000).toFixed(1)}K`; volumeHtml += `<div class="flex justify-between items-center"><span class="text-gray-300">${index + 1}. ${symbol}</span><span class="text-blue-400 font-semibold">$${volumeStr}</span></div>`; });
            document.getElementById('top-coins').innerHTML = topHtml;
            document.getElementById('worst-coins').innerHTML = worstHtml;
            document.getElementById('high-volume').innerHTML = volumeHtml;
        }

        // ================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© (Ù…Ø®ØªØµØ±Ø© ÙˆÙ„ÙƒÙ† ÙƒØ§Ù…Ù„Ø©) ==================
        function updateCharts(data) {
            if (!data?.coins) return;
            updatePerformanceChart(data);
            updateDistributionChart(data);
            updateRSIChart(data);
            updateATRChart(data);
        }
        function updatePerformanceChart(data) {
            const perfCtx = document.getElementById('performance-chart').getContext('2d');
            const symbols = data.coins.slice(0, 8).map(c => c.symbol.replace('/USDT', ''));
            const performances = data.coins.slice(0, 8).map(c => c.returns_vs_btc?.['4h'] || 0);
            if (charts.performance) charts.performance.destroy();
            charts.performance = new Chart(perfCtx, { type: 'bar', data: { labels: symbols, datasets: [{ label: 'Ø£Ø¯Ø§Ø¡ 4 Ø³Ø§Ø¹Ø§Øª Ù…Ù‚Ø§Ø¨Ù„ BTC (%)', data: performances, backgroundColor: performances.map(p => p >= 0 ? 'rgba(16, 185, 129, 0.7)' : 'rgba(239, 68, 68, 0.7)'), borderColor: performances.map(p => p >= 0 ? 'rgb(16, 185, 129)' : 'rgb(239, 68, 68)'), borderWidth: 1, borderRadius: 5 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#94a3b8' } }, x: { grid: { display: false }, ticks: { color: '#94a3b8' } } }, plugins: { legend: { display: true, labels: { color: '#94a3b8' } } } } });
        }
        function updateDistributionChart(data) {
            const distCtx = document.getElementById('distribution-chart').getContext('2d');
            const scores = data.coins.map(c => c.score || 0);
            const dataPoints = [scores.filter(s => s >= 80).length, scores.filter(s => s >= 60 && s < 80).length, scores.filter(s => s >= 40 && s < 60).length, scores.filter(s => s >= 20 && s < 40).length, scores.filter(s => s < 20).length];
            if (charts.distribution) charts.distribution.destroy();
            charts.distribution = new Chart(distCtx, { type: 'doughnut', data: { labels: ['Ø´Ø±Ø§Ø¡ Ù‚ÙˆÙŠ (â‰¥80)', 'Ø´Ø±Ø§Ø¡ (60-79)', 'Ù…Ø­Ø§ÙŠØ¯ (40-59)', 'Ø¨ÙŠØ¹ (20-39)', 'Ø¨ÙŠØ¹ Ù‚ÙˆÙŠ (<20)'], datasets: [{ data: dataPoints, backgroundColor: ['rgba(16, 185, 129, 0.8)', 'rgba(34, 197, 94, 0.8)', 'rgba(59, 130, 246, 0.8)', 'rgba(245, 158, 11, 0.8)', 'rgba(239, 68, 68, 0.8)'], borderColor: ['rgb(16, 185, 129)', 'rgb(34, 197, 94)', 'rgb(59, 130, 246)', 'rgb(245, 158, 11)', 'rgb(239, 68, 68)'], borderWidth: 2, hoverOffset: 15 }] }, options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { position: 'right', labels: { color: '#94a3b8', padding: 20 } }, tooltip: { callbacks: { label: (ctx) => { const total = ctx.dataset.data.reduce((a,b)=>a+b,0); const percentage = Math.round((ctx.raw / total)*100); return `${ctx.label}: ${ctx.raw} Ø¹Ù…Ù„Ø© (${percentage}%)`; } } } } } });
        }
        function updateRSIChart(data) {
            const rsiCtx = document.getElementById('rsi-chart').getContext('2d');
            const coins = data.coins.slice(0, 6);
            const symbols = coins.map(c => c.symbol.replace('/USDT', ''));
            const rsiValues = coins.map(c => c.rsi || 50);
            if (charts.rsi) charts.rsi.destroy();
            charts.rsi = new Chart(rsiCtx, { type: 'line', data: { labels: symbols, datasets: [{ label: 'Ù…Ø¤Ø´Ø± Ø§Ù„Ù‚ÙˆØ© Ø§Ù„Ù†Ø³Ø¨ÙŠØ© (RSI)', data: rsiValues, borderColor: 'rgb(147, 51, 234)', backgroundColor: 'rgba(147, 51, 234, 0.1)', borderWidth: 3, fill: true, tension: 0.4, pointBackgroundColor: rsiValues.map(v => v > 70 ? 'rgb(239, 68, 68)' : v < 30 ? 'rgb(16, 185, 129)' : 'rgb(59, 130, 246)'), pointBorderColor: '#fff', pointBorderWidth: 2, pointRadius: 6 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 0, max: 100, grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#94a3b8' } }, x: { grid: { color: 'rgba(255, 255, 255, 0.1)' }, ticks: { color: '#94a3b8' } } }, plugins: { legend: { display: true, labels: { color: '#94a3b8' } }, annotation: { annotations: { overbought: { type: 'line', yMin: 70, yMax: 70, borderColor: 'rgb(239, 68, 68)', borderWidth: 2, borderDash: [5,5], label: { content: 'Ù…Ø´ØªØ±Ø§Ø© Ø¨Ø´Ø¯Ø©', enabled: true, position: 'end', backgroundColor: 'rgba(239, 68, 68, 0.7)' } }, oversold: { type: 'line', yMin: 30, yMax: 30, borderColor: 'rgb(16, 185, 129)', borderWidth: 2, borderDash: [5,5], label: { content: 'Ù…Ø¨Ø§Ø¹Ø© Ø¨Ø´Ø¯Ø©', enabled: true, position: 'end', backgroundColor: 'rgba(16, 185, 129, 0.7)' } } } } } } });
        }
        function updateATRChart(data) {
            const atrCtx = document.getElementById('atr-chart').getContext('2d');
            const coins = data.coins.slice(0, 6);
            const symbols = coins.map(c => c.symbol.replace('/USDT', ''));
            const atrValues = symbols.map(() => 2 + Math.random() * 3);
            if (charts.atr) charts.atr.destroy();
            charts.atr = new Chart(atrCtx, { type: 'radar', data: { labels: symbols, datasets: [{ label: 'Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ°Ø¨Ø°Ø¨ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (ATR %)', data: atrValues, backgroundColor: 'rgba(245, 158, 11, 0.2)', borderColor: 'rgb(245, 158, 11)', borderWidth: 2, pointBackgroundColor: 'rgb(245, 158, 11)', pointBorderColor: '#fff', pointBorderWidth: 2, pointRadius: 4 }] }, options: { responsive: true, maintainAspectRatio: false, scales: { r: { angleLines: { color: 'rgba(255, 255, 255, 0.1)' }, grid: { color: 'rgba(255, 255, 255, 0.1)' }, pointLabels: { color: '#94a3b8' }, ticks: { color: '#94a3b8', backdropColor: 'transparent' } } }, plugins: { legend: { display: true, labels: { color: '#94a3b8' } } } } });
        }

        // ================== Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª ÙˆØ§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ==================
        function checkAlerts(coins) {
            const strongBuyCoins = coins.filter(c => c.recommendation === 'STRONG_BUY');
            const strongSellCoins = coins.filter(c => c.recommendation === 'STRONG_SELL');
            const signalsContainer = document.getElementById('signals-container');
            let signalsHtml = '';
            if (strongBuyCoins.length > 0) signalsHtml += `<div class="bg-gradient-to-r from-green-900/30 to-green-700/30 p-3 rounded-lg border border-green-800/50"><div class="flex items-center"><i class="fas fa-rocket text-green-400 text-xl ml-2"></i><div><div class="font-semibold">${strongBuyCoins.length} Ø¥Ø´Ø§Ø±Ø© Ø´Ø±Ø§Ø¡ Ù‚ÙˆÙŠØ©</div><div class="text-xs text-gray-400 mt-1">${strongBuyCoins.map(c => c.symbol.replace('/USDT', '')).join(', ')}</div></div></div></div>`;
            if (strongSellCoins.length > 0) signalsHtml += `<div class="bg-gradient-to-r from-red-900/30 to-red-700/30 p-3 rounded-lg border border-red-800/50"><div class="flex items-center"><i class="fas fa-bomb text-red-400 text-xl ml-2"></i><div><div class="font-semibold">${strongSellCoins.length} Ø¥Ø´Ø§Ø±Ø© Ø¨ÙŠØ¹ Ù‚ÙˆÙŠØ©</div><div class="text-xs text-gray-400 mt-1">${strongSellCoins.map(c => c.symbol.replace('/USDT', '')).join(', ')}</div></div></div></div>`;
            if (signalsHtml === '') signalsHtml = `<div class="text-center py-4 text-gray-500"><i class="fas fa-check-circle text-green-400 text-xl mb-2"></i><p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù†Ø´Ø·Ø©</p><p class="text-xs mt-1">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª Ø¶Ù…Ù† Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ</p></div>`;
            signalsContainer.innerHTML = signalsHtml;
            if (userSettings.soundAlerts && (strongBuyCoins.length > 0 || strongSellCoins.length > 0)) playAlertSound();
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const icon = type === 'success' ? 'fa-check-circle text-green-400' : type === 'error' ? 'fa-exclamation-circle text-red-400' : 'fa-info-circle text-blue-400';
            notification.className = `fixed top-4 left-4 glass-card p-4 max-w-sm animate-slide-in z-50`;
            notification.innerHTML = `<div class="flex items-center"><i class="fas ${icon} text-xl ml-3"></i><div><p class="font-semibold">${message}</p><p class="text-xs text-gray-400 mt-1">${luxon.DateTime.now().setZone('Asia/Damascus').toFormat('HH:mm:ss')}</p></div></div>`;
            document.body.appendChild(notification);
            setTimeout(() => { notification.classList.add('opacity-0', 'transition-opacity', 'duration-300'); setTimeout(() => notification.remove(), 300); }, 3000);
        }
        function showError(message) { showNotification(message, 'error'); }

        // ================== Ø¯ÙˆØ§Ù„ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¯Ø§ÙˆÙ„ (Ù…Ø­Ø¯Ø«Ø©) ==================
        function openTradeModal(symbol, side, currentPrice, confidence) {
            document.getElementById('modal-pair-name').innerText = symbol;
            document.getElementById('trade-symbol').value = symbol;
            document.getElementById('trade-side').value = side;
            document.getElementById('summary-pair').innerText = symbol;
            document.getElementById('summary-side').innerHTML = `<span class="${side === 'BUY' ? 'text-green-400' : 'text-red-400'}">${side === 'BUY' ? 'Ø´Ø±Ø§Ø¡ (LONG)' : 'Ø¨ÙŠØ¹ (SHORT)'}</span>`;
            
            document.getElementById('quantity').value = '0.001';
            document.getElementById('quantity-type').value = 'base';
            document.getElementById('leverage').value = '1';
            document.getElementById('stop-loss').value = '';
            document.getElementById('take-profit').value = '';
            document.getElementById('limit-price').value = currentPrice.toFixed(2);
            
            // ØªÙ‡ÙŠØ¦Ø© Ù†ÙˆØ¹ Ø§Ù„ØªÙ†ÙÙŠØ°: ÙÙˆØ±ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹
            document.querySelector('input[name="executionType"][value="IMMEDIATE"]').checked = true;
            document.getElementById('scheduled-datetime-container').classList.add('hidden');
            document.getElementById('summary-scheduled').classList.add('hidden');
            
            const limitContainer = document.getElementById('limit-price-container');
            const marketRadio = document.querySelector('input[name="orderType"][value="MARKET"]');
            marketRadio.checked = true;
            limitContainer.classList.add('hidden');
            
            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª (Ø§Ù„Ø¢Ù† + Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©)
            const now = luxon.DateTime.now().setZone('Asia/Damascus');
            const minDateTime = now.plus({ minutes: 1 }).toFormat("yyyy-MM-dd'T'HH:mm");
            document.getElementById('scheduled-time').setAttribute('min', minDateTime);
            document.getElementById('scheduled-time').value = now.plus({ hours: 1 }).toFormat("yyyy-MM-dd'T'HH:mm");
            
            updateTradeSummary();
            document.getElementById('trade-modal').classList.remove('hidden');
        }

        function closeTradeModal() {
            document.getElementById('trade-modal').classList.add('hidden');
        }

        // ØªØ­Ø¯ÙŠØ« Ù…Ù„Ø®Øµ Ø§Ù„ØµÙÙ‚Ø© Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„
        function updateTradeSummary() {
            const qty = parseFloat(document.getElementById('quantity').value) || 0;
            const qtyType = document.getElementById('quantity-type').value;
            const price = parseFloat(document.getElementById('limit-price').value) || 0;
            const isMarket = document.querySelector('input[name="orderType"]:checked').value === 'MARKET';
            const symbol = document.getElementById('trade-symbol').value;
            const base = symbol.replace('USDT', '');
            
            let summaryQty = qtyType === 'base' ? `${qty} ${base}` : `${qty} USDT`;
            let summaryValue = '--';
            if (qty > 0) {
                if (qtyType === 'base' && !isMarket) summaryValue = `â‰ˆ ${(qty * price).toFixed(2)} USDT`;
                else if (qtyType === 'quote') summaryValue = `${qty} USDT`;
            }
            document.getElementById('summary-qty').innerText = summaryQty;
            document.getElementById('summary-value').innerText = summaryValue;
            
            // Ø¹Ø±Ø¶ ÙˆÙ‚Øª Ø§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„ Ø¥Ø°Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø±Ù‡
            const execType = document.querySelector('input[name="executionType"]:checked').value;
            if (execType === 'SCHEDULED') {
                const scheduledTime = document.getElementById('scheduled-time').value;
                if (scheduledTime) {
                    const formatted = luxon.DateTime.fromISO(scheduledTime).setZone('Asia/Damascus').toFormat('yyyy-MM-dd HH:mm');
                    document.getElementById('summary-datetime').innerText = formatted;
                    document.getElementById('summary-scheduled').classList.remove('hidden');
                } else {
                    document.getElementById('summary-scheduled').classList.add('hidden');
                }
            } else {
                document.getElementById('summary-scheduled').classList.add('hidden');
            }
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø£Ù…Ø± Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø³ØªÙ‚Ù„
        async function submitOrder() {
            const execType = document.querySelector('input[name="executionType"]:checked').value;
            const orderData = {
                symbol: document.getElementById('trade-symbol').value,
                side: document.getElementById('trade-side').value,
                type: document.querySelector('input[name="orderType"]:checked').value,
                quantity: parseFloat(document.getElementById('quantity').value),
                quantityType: document.getElementById('quantity-type').value,
                leverage: parseInt(document.getElementById('leverage').value) || 1,
                stopLoss: parseFloat(document.getElementById('stop-loss').value),
                stopLossType: document.getElementById('sl-type').value,
                takeProfit: parseFloat(document.getElementById('take-profit').value),
                takeProfitType: document.getElementById('tp-type').value,
                timeInForce: document.getElementById('time-in-force').value,
                executionType: execType
            };

            if (execType === 'SCHEDULED') {
                const scheduledTime = document.getElementById('scheduled-time').value;
                if (!scheduledTime) {
                    showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„ØªÙ†ÙÙŠØ°', 'error');
                    return;
                }
                orderData.scheduledTime = luxon.DateTime.fromISO(scheduledTime).setZone('Asia/Damascus').toISO();
            }

            if (orderData.type === 'LIMIT') {
                orderData.price = parseFloat(document.getElementById('limit-price').value);
                if (!orderData.price || orderData.price <= 0) {
                    showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø³Ø¹Ø± Ø§Ù„Ø­Ø¯', 'error');
                    return;
                }
            }

            if (!orderData.quantity || orderData.quantity <= 0) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ§Ù„Ø­Ø©', 'error');
                return;
            }

            showLoading('Ø¬Ø§Ø±ÙŠ ØªÙ†ÙÙŠØ° Ø§Ù„ØµÙÙ‚Ø©...');

            try {
                const response = await axios.post(`${EXECUTOR_API_URL}/api/execute`, orderData, {
                    headers: {
                        'Authorization': `Bearer ${EXECUTOR_API_KEY}`,
                        'Content-Type': 'application/json'
                    }
                });

                hideLoading();

                if (response.data.success) {
                    const msg = execType === 'SCHEDULED' 
                        ? `âœ… ØªÙ… Ø¬Ø¯ÙˆÙ„Ø© Ø§Ù„ØµÙÙ‚Ø© Ø¨Ù†Ø¬Ø§Ø­\nØ§Ù„Ù…Ø¹Ø±Ù: ${response.data.order_id}`
                        : `âœ… ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„ØµÙÙ‚Ø© Ø¨Ù†Ø¬Ø§Ø­\nØ±Ù‚Ù… Ø§Ù„Ø£Ù…Ø±: ${response.data.order_id}`;
                    showNotification(msg, 'success');
                    showOrderStatus(response.data.order_id, orderData.symbol, execType);
                    closeTradeModal();
                } else {
                    showNotification(`âŒ ÙØ´Ù„ Ø§Ù„ØªÙ†ÙÙŠØ°: ${response.data.error || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`, 'error');
                }
            } catch (error) {
                hideLoading();
                const msg = error.response?.data?.error || error.message;
                showNotification(`âŒ Ø®Ø·Ø£: ${msg}`, 'error');
            }
        }

        // Ø¹Ø±Ø¶ Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ù…Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØªÙ†ÙÙŠØ°
        function showOrderStatus(orderId, symbol, execType) {
            const statusHtml = `
                <div id="order-status-${orderId}" class="fixed bottom-4 left-4 glass-card p-4 max-w-sm z-50 border-r-4 border-green-500">
                    <div class="flex items-center">
                        <i class="fas ${execType === 'SCHEDULED' ? 'fa-calendar-check' : 'fa-check-circle'} text-green-400 text-xl ml-3"></i>
                        <div>
                            <p class="font-semibold">âœ… ${execType === 'SCHEDULED' ? 'ØªÙ…Øª Ø§Ù„Ø¬Ø¯ÙˆÙ„Ø©' : 'ØªÙ… Ø§Ù„ØªÙ†ÙÙŠØ°'}</p>
                            <p class="text-xs text-gray-400 mt-1">Ø§Ù„Ø£Ù…Ø±: #${orderId}</p>
                            <p class="text-xs text-gray-400">${symbol}</p>
                            <button onclick="this.parentElement.parentElement.parentElement.remove()" class="text-xs text-blue-400 mt-2">Ø¥Ø®ÙØ§Ø¡</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', statusHtml);
            setTimeout(() => {
                const el = document.getElementById(`order-status-${orderId}`);
                if (el) el.remove();
            }, 10000);
        }

        // Ø±Ø¨Ø· Ø£Ø­Ø¯Ø§Ø« ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ø®Øµ ÙˆØ§Ù„ØªÙ†ÙÙŠØ° Ø§Ù„Ù…Ø¬Ø¯ÙˆÙ„
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('quantity').addEventListener('input', updateTradeSummary);
            document.getElementById('quantity-type').addEventListener('change', updateTradeSummary);
            document.getElementById('limit-price').addEventListener('input', updateTradeSummary);
            document.getElementsByName('orderType').forEach(r => r.addEventListener('change', updateTradeSummary));
            document.getElementsByName('executionType').forEach(r => r.addEventListener('change', function() {
                const container = document.getElementById('scheduled-datetime-container');
                if (this.value === 'SCHEDULED') container.classList.remove('hidden');
                else container.classList.add('hidden');
                updateTradeSummary();
            }));
            document.getElementById('scheduled-time').addEventListener('change', updateTradeSummary);
        });

        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø£Ø®Ø±Ù‰ (ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£ØµÙ„ÙŠ)
        function tradeSingle(symbol, recommendation) {
            if (!currentData?.coins) return;
            const coin = currentData.coins.find(c => c.symbol === symbol);
            if (!coin) return;
            const side = (recommendation.includes('BUY') || recommendation.includes('LONG')) ? 'BUY' : 'SELL';
            openTradeModal(symbol, side, coin.price_usdt || 0, coin.score || 0);
        }

        window.tradePair = function(pair, recommendation, confidence) {
            const symbol = pair.replace('/', '') + 'USDT';
            let price = 0;
            if (currentData && currentData.coins) {
                const coin = currentData.coins.find(c => c.symbol === symbol);
                if (coin) price = coin.price_usdt || 0;
            }
            const side = recommendation.includes('LONG') ? 'BUY' : 'SELL';
            openTradeModal(symbol, side, price, confidence);
        };

        // Ø¯ÙˆØ§Ù„ Ø£Ø®Ø±Ù‰ (Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ ØªØµØ¯ÙŠØ±ØŒ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„Ø©ØŒ Ø¥Ù„Ø®) - Ù†Ø³Ø®Ø© Ù…Ø®ØªØµØ±Ø© Ù„ÙƒÙ†Ù‡Ø§ ÙƒØ§ÙÙŠØ©
        function showLoading(message) { document.getElementById('loading-message').innerText = message; document.getElementById('loading-overlay').classList.remove('hidden'); }
        function hideLoading() { document.getElementById('loading-overlay').classList.add('hidden'); }
        async function triggerAnalysis() { /* ... */ }
        async function testNotification() { /* ... */ }
        function playAlertSound() { try { new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==').play(); } catch(e) {} }
        function toggleTheme() { /* ... */ }
        function toggleHeatmapView() { const c = document.getElementById('heatmap-container'); c.classList.toggle('grid-cols-5'); c.classList.toggle('grid-cols-3'); }
        function showSettings() { document.getElementById('settings-modal').classList.remove('hidden'); }
        function closeSettings() { document.getElementById('settings-modal').classList.add('hidden'); }
        function saveSettings() { /* ... */ showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª', 'success'); closeSettings(); }
        function exportToCSV() { /* ... */ }
        function showCoinDetails(symbol) { /* ... */ }
        function analyzeCoin(symbol) { window.open(`/api/chart/data/${symbol}?timeframe=4h`, '_blank'); }
        function showAllPairs() { showNotification('Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²ÙˆØ§Ø¬ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info'); }
        function showRankingDetails() { showNotification('ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info'); }
        function showHistoricalAnalysis() { showNotification('Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®ÙŠ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±', 'info'); }
        function toggleAlerts() { userSettings.soundAlerts = !userSettings.soundAlerts; localStorage.setItem('cryptoScannerSettings', JSON.stringify(userSettings)); showNotification(userSettings.soundAlerts ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©' : 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø§Ù„ØµÙˆØªÙŠØ©', 'success'); }

        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            const savedSettings = localStorage.getItem('cryptoScannerSettings');
            if (savedSettings) {
                userSettings = { ...userSettings, ...JSON.parse(savedSettings) };
                document.getElementById('update-interval').value = userSettings.refreshInterval / 1000;
                document.getElementById('sound-alerts').checked = userSettings.soundAlerts;
                document.getElementById('desktop-alerts').checked = userSettings.desktopAlerts;
                document.querySelector(`input[name="view-mode"][value="${userSettings.viewMode}"]`).checked = true;
            }
            updateSyriaTime();
            setInterval(updateSyriaTime, 1000);
            refreshAll();
            if (userSettings.refreshInterval > 0) updateInterval = setInterval(refreshAll, userSettings.refreshInterval);
            const savedTheme = localStorage.getItem('theme') || 'dark';
            const themeIcon = document.getElementById('theme-icon');
            if (savedTheme === 'dark') { document.documentElement.classList.add('dark'); themeIcon.classList.add('fa-moon'); themeIcon.classList.remove('fa-sun'); }
            else { document.documentElement.classList.remove('dark'); themeIcon.classList.remove('fa-moon'); themeIcon.classList.add('fa-sun'); }
            const style = document.createElement('style');
            style.textContent = `@keyframes slide-in { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } } .animate-slide-in { animation: slide-in 0.3s ease-out; }`;
            document.head.appendChild(style);
        });

        window.addEventListener('beforeunload', function() { if (updateInterval) clearInterval(updateInterval); });
    </script>
</body>
</html>
